#!/bin/bash

if [ $# -eq 0 ]
  then
    name='vpp-run'
  else
    name=$1
fi

state=$(docker inspect -f '{{.State.Running}}' $name)
state="$(echo -e "${state}" | tr -d '[:space:]')"
if [[ "$state" != "true" ]]; then
  docker start $name &> /dev/null
fi

vppctl=$(docker exec -it $name which vppctl)
if [ $? -ne 0 ]; then
  exit 1
fi
vppctl="$(echo -e "${vppctl}" | tr -d '[:space:]')"

# wait indefinitely for vpp to start
while true; do
  docker exec -it $name ls /run/vpp/cli.sock &> /dev/null
  if [ $? -eq 0 ]; then
    break
  fi
  sleep 1
done
docker exec -it $name $vppctl ${@:2}
